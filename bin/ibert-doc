#!/usr/bin/env python3
"""CLI script for generating function documentation."""

import sys
from pathlib import Path

# Add src to path
src_path = Path(__file__).parent.parent / "src"
sys.path.insert(0, str(src_path))

from ibert.cli_utils import read_input
from ibert.config import load_config
from ibert.models import create_model
from ibert.tasks import FunctionDocumentationTask


def main():
    """Generate docstrings for Ibis functions."""
    import argparse

    parser = argparse.ArgumentParser(
        description="Generate docstrings for Ibis functions"
    )
    parser.add_argument(
        "input",
        nargs="?",
        help="File containing code to document, or use stdin",
    )
    parser.add_argument(
        "--style",
        default="google",
        choices=["google", "numpy"],
        help="Docstring style",
    )
    parser.add_argument(
        "--no-examples",
        action="store_true",
        help="Do not include examples in docstring",
    )
    parser.add_argument(
        "--config",
        type=Path,
        help="Path to config file",
    )

    args = parser.parse_args()

    # Load configuration
    config = load_config(args.config)

    # Read input with helpful error messages
    input_text = read_input(args.input, "ibert-doc")

    # Create model and task
    try:
        model = create_model(config)
        task = FunctionDocumentationTask(model)

        # Execute task
        kwargs = {
            "style": args.style,
            "include_examples": not args.no_examples,
        }

        result = task.execute(input_text, **kwargs)
        print(result)

    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)


if __name__ == "__main__":
    main()
